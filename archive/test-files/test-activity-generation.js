const { createClient } = require('@supabase/supabase-js');
const fs = require('fs');
const path = require('path');

const envPath = path.join(__dirname, '.env.local');
const envContent = fs.readFileSync(envPath, 'utf-8');
const envVars = {};

envContent.split('\n').forEach(line => {
  if (line && !line.startsWith('#')) {
    const [key, value] = line.split('=');
    if (key && value) {
      envVars[key.trim()] = value.trim();
    }
  }
});

const supabaseUrl = envVars.NEXT_PUBLIC_SUPABASE_URL;
const supabaseKey = envVars.SUPABASE_SERVICE_ROLE_KEY;
const supabase = createClient(supabaseUrl, supabaseKey);

async function generateTestActivity() {
  console.log('Generating test activities with descriptions...\n');

  const userId = '2dde9eee-6409-4288-b686-444d39f7eb4a'; // Ian

  // Test activities that would be generated by the API
  const activities = [
    {
      user_id: userId,
      action: 'job.collaborator_added',
      status: 'success',
      details: {
        job_id: 'test-job-id',
        job_number: '123',
        job_venue: 'Test Venue',
        collaborator_name: 'Beau Dawson',
        added_by_name: 'Ian Klopper'
      },
      description: 'Ian Klopper added Beau Dawson to job 123'
    },
    {
      user_id: userId,
      action: 'job.status_changed',
      status: 'success',
      details: {
        job_id: 'test-job-id',
        job_number: '123',
        job_venue: 'Test Venue',
        old_status: 'draft',
        new_status: 'live',
        user_name: 'Ian Klopper'
      },
      description: 'Ian Klopper changed status of job 123 from draft to live'
    },
    {
      user_id: userId,
      action: 'user.color_changed',
      status: 'success',
      details: {
        target_user_name: 'Beau Dawson',
        new_color: 'green',
        user_name: 'Ian Klopper'
      },
      description: 'Ian Klopper changed Beau Dawson color to green'
    }
  ];

  for (const activity of activities) {
    const { error } = await supabase
      .from('activity_logs')
      .insert(activity);

    if (error) {
      console.error('Error inserting:', error);
    } else {
      console.log(`✓ Created: "${activity.description}"`);
    }
  }

  console.log('\n✓ Test activities generated. Check your activity log page now.');
}

generateTestActivity();